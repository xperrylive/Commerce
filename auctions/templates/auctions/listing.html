{% extends "auctions/layout.html" %}

{% block title %}
    {{ listing.title }}
{% endblock %}

{% block body %}

<h1>{{listing.title}}</h1>

{% if not listing.is_active and request.user == listing.winner%}
<div class="alert alert-success" role="alert">
  <h4 class="alert-heading">Congratulation!</h4>
  <p>YAHOOO, you successfully won this auction. Your item will be shipped soon!.</p>
  <hr>
  <p class="mb-0">You won by bidding {{current_price}}$.</p>
</div>
{% endif %}

<div class="card mb-3 mt-3">
    {% if listing.image_url %}
    <img src="{{listing.image_url}}" class="card-img-top" alt="{{listing.title}}" style="width: 250px;">
    {% endif %}
    <div class="card-body">
        <p class="card-text">{{listing.description}}</p>
        <h4>Startin Price: {{listing.starting_bid}}$</h4>
        {% if highest_bidder%}
        <p class="card-text"><small class="text-muted">Highest Bid: {{current_price}}$ by [{{highest_bidder}}] </small></p>
        {% endif %}

        {% if request.user.is_authenticated and request.user != listing.owner and listing.is_active%}
            {% if error %} 
            <div class="alert alert-danger" role="alert">
                {{error}} 
            </div>
            {% endif %} 

            <form action="{% url 'listing' listing.id %}" method="post">
            <div class="input-group mb-3">
                    {% csrf_token %}
                    <input  type="number" step="0.01" name="bid_amount" class="form-control" min="{{min_bid}}" aria-label="Dollar amount (with dot and two decimal places)" placeholder="Enter your bid amount" >
                    <span class="input-group-text">$</span>
                    <input class="btn btn-primary" type="submit" value="Bid">
            </div>
            </form>
        {% endif %}

        <div class="wishlist mb-3">
            <form method="post" action="{% url 'watchlist_toggle' listing.id %}">
                {% csrf_token %}
                {% if request.user in listing.watched_by.all%} 
                <button class="btn btn-primary" type="submit"> <i class="fa-solid fa-bookmark" style="color: white;"></i> </button>
                {% else %}
                <button class="btn btn-primary" type="submit"> <i class="fa-regular fa-bookmark" style="color: white;"></i> </button>       
                {% endif %}
            </form>
        </div>
        
        {% if request.user == listing.owner and listing.is_active %}
            <div class="close-auction-section mb-3">
                <form action="{% url 'close_auction' listing.id %} " method="post">
                    {% csrf_token %}
                    <input class="btn btn-danger" type="submit" value="Close Auction">
                </form>
            </div>
        {% endif %}
        <p class="card-text"><small class="text-muted">Created By: {{listing.owner}} </small></p>
    </div>
</div>

<div class="card mb-3">
    <h3>Comment Section</h3>
    {% for comment in comments %}
    <div class="section" style="width: 100%; max-width: 800px; margin: 20px ;">
        <small class="text-muted">
            <span>{{comment.user}}</span>
            <span>{{comment.date}}</span>
            {% if comment.user == listing.owner%}
                <span style="color: red;"> Creator </span>
            {% endif %}
        </small>
        <p>{{comment.content}}</p>
    </div>
    {% empty%}
        <p>No Comments</p>
    {% endfor %}
</div>
{% if request.user.is_authenticated %}
<form action="{% url 'add_comment' listing.id %}" method="POST">
    {% csrf_token %}
    <div class="mb-3">
        <label for="comment" class="form-label">Add a Comment</label>
        <textarea class="form-control" id="comment" name="comment_content" rows="3" required></textarea>
    </div>
    <button type="submit" class="btn btn-primary">Submit</button>
</form>
{% endif %}

{% endblock %}


